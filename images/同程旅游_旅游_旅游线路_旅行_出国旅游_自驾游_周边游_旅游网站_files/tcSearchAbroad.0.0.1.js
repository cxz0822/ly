fish.ready(function(){function grouping(a,b){for(var c=[],d=0;d<b.length;d++)for(var e=0;e<a.length;e++)b[d].FirstLetter===a[e]&&c.push({citytitle:a[e],citybody:b[d].MatchCitys});return c}function setNotice(a,b,c,d){var e='<div class="mNotice-mTab"> <h4 class="mNotice-mTab-head">'+c+"<span>"+(d&&"(可直接输入城市名)")+'</span></h4> <div class="ab_mNotice mNotice-mTab-wrap"> <ul class="mNotice-mTab-tab-tray clearfix">{tabLis}</ul> {tabCons}</div> </div> ';fish.require("mNotice",function(){fish.one("#"+a).mNotice({mode:"mTab",theme:"hotel_s_warp",offset:{x:0,y:12},isClick:!0,isHover:!0,isSelect:!0,dataBoxType:a,localData:b,template:e,display:showData})})}function showData(a,b,c){var d,e,f=a.title;return c=a.newtype||0,d=handlerTab.call(f),e=handlerTabCon.call(a,c),b=b.replace("{tabLis}",d).replace("{tabCons}",e)}function handlerTab(){var a='<li class="mNotice-mTab-item current">热门</li>',b=this;for(var c in b)b.hasOwnProperty(c)&&(a+='<li class="mNotice-mTab-item">'+b[c]+"</li>");return a}function handlerTabCon(a){var b='<div class="mNotice-mTab-content clearfix {none}">{childrenNodes}</div>',c=this,d=c.common,e="";e=b.replace("{childrenNodes}",handlerHotData.call(c,a)).replace("{none}","");for(var f=0;f<d.length;f++)e+=b.replace("{childrenNodes}",handlerChildData.call(d[f],f,a)).replace("{none}","none");return e}function handlerHotData(a){window.hotData=this.hot;var b='<dl class="clearfix"><dd>';for(var c in hotData)if(hotData.hasOwnProperty(c))if(a)b+='<a href="javascript:void(0)" title="'+hotData[c].Name.split("|")[0]+'" target="_self" class="mNotice-normal">'+hotData[c].Name.split("|")[0]+"</a>";else{var d=hotData[c].split("|")[0];b+='<a href="javascript:void(0)" title="'+d+'" target="_self" class="mNotice-normal visa_tip">'+d+"</a>"}return b+="</dd></dl>"}function handlerChildData(a,b){var c=this,d=c.cities,e=window.hotData,f=d.length,g="";if(b)for(var h=0;h<d[0].children.length;h++){for(var i="",j=1,k=0;k<d[0].children[h].citybody.length;k++){for(var l=0;l<e.length;l++)if(e[l].Name===d[0].children[h].citybody[k].Name){i+='<a href="javascript:void(0)" target="_self" class="mNotice-normal subcur" title="'+d[0].children[h].citybody[k].Name+'">'+d[0].children[h].citybody[k].Name+"</a>",j=0;break}j&&(i+='<a href="javascript:void(0)" target="_self" class="mNotice-normal" title="'+d[0].children[h].citybody[k].Name+'">'+d[0].children[h].citybody[k].Name+"</a>"),j=1}g+='<dl class="clearfix mNotice-block"><dt class="mNotice-title">'+d[0].children[h].citytitle+'</dt><dd class="mNotice-def">'+i+"</dd></dl>"}else if(1===f){for(var m in d[0].children)if(d[0].children.hasOwnProperty(m)){var n=d[0].children[m].split("|")[0];g+='<a href="javascript:void(0)" title="'+n+'" target="_self" class="mNotice-normal">'+n+"</a>"}}else for(var o=0;f>o;o++){""!==d[o].parent&&(g+='<a href="javascript:void(0)" title="'+d[o].parent.split("|")[0]+'" target="_self" class="notice_main_title mNotice-normal">'+d[o].parent.split("|")[0]+"</a>");for(var p in d[o].children)d[o].children.hasOwnProperty(p)&&(g+='<a href="javascript:void(0)" title="'+d[o].children[p].split("|")[0]+'" target="_self" class="mNotice-normal">'+d[o].children[p].split("|")[0]+"</a>")}return g}function getkeywords(a){if(!(a>1||0>a)){var b,c=fish.all("#tab_top_holiday .ab_con")[a];b=["udiy-cjgentuan-hotactive,udiy-cjgentuan-hotcitypic","udiy-cjziyou-hotactive,udiy-cjziyou-hotcitypic"],fish.one(c).attr("isload")||fish.ajax({url:"/AjaxHelper/AsyncHandler.ashx?"+fish.one("#diysearchpara").val()+"&idlist="+b[a],fn:function(a){if(a){var b=splitData(a);fish.one(".recom_list",c).html(fish.create(b[0]).html()),fish.one(".c_search_citypic ",c).html(fish.create(b[1]).html()),fish.one(c).attr("isload","1")}}})}}function splitData(a){var b="split|,|split",c="split|:|split",d=a.split(b),e=[];if(null!=d&&d.length>0){for(var f=0;f<d.length;f++){var g=d[f].split(c);null!=g&&2==g.length&&e.push(g[1])}return e}}var Ajaxurl="/dujia/AjaxActivity.aspx?type=QueryIndexTotalCity&lineType=";fish.ajax({url:Ajaxurl+"0",type:"jsonp",fn:function(data){var gCityInfo,gStartData,gDesData;gCityInfo=data,gStartData={hot:gCityInfo.group.start.hot,newtype:1,title:["ABCDEF","GHJKLM","NPQRS","TWXYZ"],common:[{desc:"ABCDEF",cities:[{parent:"",children:grouping("ABCDEF",eval(gCityInfo.group.start.common))}]},{desc:"GHJKLM",cities:[{parent:"",children:grouping("GHJKLM",eval(gCityInfo.group.start.common))}]},{desc:"NPQRS",cities:[{parent:"",children:grouping("NPQRS",eval(gCityInfo.group.start.common))}]},{desc:"TWXYZ",cities:[{parent:"",children:grouping("TWXYZ",eval(gCityInfo.group.start.common))}]}]},gDesData=gCityInfo.group.dest,setNotice("genStartCity",gStartData,"出发地",""),setNotice("genEndCityValue",gDesData,"目的地",1)}}),fish.ajax({url:Ajaxurl+"1",type:"jsonp",fn:function(data){var zCityInfo,zStartData,zDesData;zCityInfo=data,zStartData={hot:zCityInfo.free.start.hot,newtype:1,title:["ABCDEF","GHJKLM","NPQRS","TWXYZ"],common:[{desc:"ABCDEF",cities:[{parent:"",children:grouping("ABCDEF",eval(zCityInfo.free.start.common))}]},{desc:"GHJKLM",cities:[{parent:"",children:grouping("GHJKLM",eval(zCityInfo.free.start.common))}]},{desc:"NPQRS",cities:[{parent:"",children:grouping("NPQRS",eval(zCityInfo.free.start.common))}]},{desc:"TWXYZ",cities:[{parent:"",children:grouping("TWXYZ",eval(zCityInfo.free.start.common))}]}]},zDesData=zCityInfo.free.dest,setNotice("ziStartCity",zStartData,"出发地",""),setNotice("ziEndCityValue",zDesData,"目的地",1)}}),fish.all(".ab_con_tab li").on("click",function(){var a;fish.all(".ab_con_tab li,.ab_con").removeClass("at"),a=fish.one(this).addClass("at").attr("data-index"),fish.one(fish.all(".ab_con")[a]).addClass("at"),getkeywords(a)}),getkeywords(fish.all(".ab_con_tab li").indexOf(fish.dom(".ab_con_tab li.at"))),fish.all("#genEndCityValue,#ziEndCityValue").on("focus",function(){var a=(fish.one(this).attr("attrvalu"),fish.one(this).val());(""!=a||"韩国"==a)&&fish.one(this).val(""),fish.one(this).css("color: #333")}),fish.all("#genEndCityValue,#ziEndCityValue").on("blur",function(){var a=(fish.one(this).attr("attrvalu"),fish.one(this).val());""==a&&(fish.one(this).val(fish.one(this).attr("attrvalu")),fish.one(this).css("color: #999"))}),fish.all("#genAbSearch,#ziAbSearch").on("click",function(){var a=fish.trim(fish.one("#genStartCity").val()),b=fish.trim(fish.one("#genEndCityValue").val()),c=fish.trim(fish.one("#ziStartCity").val()),d=fish.trim(fish.one("#ziEndCityValue").val()),e="http://www.ly.com/dujia/",f="";f="跟团游"==fish.one(".ab_con_tab .at").attr("title")?"search.aspx?src="+encodeURIComponent(a)+"&dest="+encodeURIComponent(b)+"&prop=1":"search.aspx?src="+encodeURIComponent(c)+"&dest="+encodeURIComponent(d)+"&prop=2",window.location.href=e+f})}),function(){function a(){var a=fish.dom("#abVisa").value;for(a=a.replace(/[<>+【】？（）\[\]()……￥$%.*&-_#~·]/g,"");-1!=a.indexOf(" ");)a=a.replace(" ","");a=""===a?b:a,fish.ajax({url:"/dujia/AjaxCallNew.aspx?type=GetNewVisaCountryUrl1&cityname="+encodeURIComponent(a)+"&citytype=&locality="+(fish.cookie.get("NCid")||0),fn:function(a){a?window.location.href=a:(fish.all(".abVisaDiv .autofill_wrap").html("remove"),fish.one("#abVisa").html("after",'<div id="" class="autofill_wrap autofill_wrap_large hotel_s_warp" style="left: 63px;top: 39px; display: block;width: 236px;"><span class="list_arrow"><i></i></span><p class="show_title"><span class="autofill_hd_inner">暂无该国家签证，请重新输入</span><span class="autofill_close show_title"></span></p></div>'),fish.one(".abVisaDiv .autofill_close").on("click",function(a){fish.one(".abVisaDiv .autofill_wrap").css("display:none"),fish.stopBubble(a)}),fish.all(".hotel_s_warp").on("click",function(a){fish.stopBubble(a)}),document.onclick=function(){fish.one(".abVisaDiv .autofill_wrap").css("display:none")})}})}var b=fish.one("#abVisa").attr("attrvalu");fish.on("focus",function(){var a=fish.dom("#abVisa");a.value==b&&(a.value=""),a.style.color="#333"},"#abVisa"),fish.on("blur",function(){var a=fish.dom("#abVisa");0==a.value.length&&(a.value=b,a.style.color="#999")},"#abVisa"),fish.one("#abVisaSearch").on("click",function(){a()}),fish.one("#abVisa").on("keyup",function(b){var c=fish.getEvent(b),d=c.keyCode?c.keyCode:b.which;13==d&&a()})}(),fish.ready(function(){function a(){var a=fish.dom("#abPlayCity").value;for(a=a.replace(/[<>+【】？（）\[\]()……￥$%.*&-_#~·]/g,"");-1!=a.indexOf(" ");)a=a.replace(" ","");a=""===a?b:a,window.location.href="http://www.ly.com/dujia/wanle/searchlist_"+a+".html"}var b=fish.one("#abPlayCity").attr("attrvalu");fish.on("focus",function(){var a=fish.dom("#abPlayCity");a.value==b&&(a.value=""),a.style.color="#333"},"#abPlayCity"),fish.on("blur",function(){var a=fish.dom("#abPlayCity");0==a.value.length&&(a.value=b,a.style.color="#999")},"#abPlayCity"),fish.one("#abPlaySearch").on("click",function(){a()}),fish.one("#abPlayCity").on("keyup",function(b){var c=fish.getEvent(b),d=c.keyCode?c.keyCode:b.which;13==d&&a()})}),fish.ready(function(){!function(){for(var a=fish.one("#SelectedCityId").val(),b=fish.all(".c_s_cityid a"),c=0;c<b.length;c++)b[c].href=b[c].href.replace("/f321/","/f"+a+"/")}()});